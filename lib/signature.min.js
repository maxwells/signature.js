(function(){var k,d=function(a,e){return function(){return a.apply(e,arguments)}};k=function(){function a(e){this.onMouseOver=d(this.onMouseOver,this);this.onMouseOut=d(this.onMouseOut,this);this.onMouseUp=d(this.onMouseUp,this);this.onMouseDown=d(this.onMouseDown,this);this.onMouseMove=d(this.onMouseMove,this);this.determinePosition=d(this.determinePosition,this);null==e.displayId&&alert("Signature\u00a0requires a displayId in the options hash passed to it's constructor");this.options=e;this.display=
document.getElementById(e.displayId);this.width=this.display.clientWidth;this.height=this.display.clientHeight;this.initializeCanvas();null!=e.watermark?this.setWatermark(e.watermark):this.setupPad();this.setupListeners()}a.NORTH_WEST=1;a.NORTH=2;a.NORTH_EAST=3;a.WEST=4;a.CENTER=5;a.EAST=6;a.SOUTH_WEST=7;a.SOUTH=8;a.SOUTH_EAST=9;a.prototype.setWatermark=function(e){var a,c=this;if(e.url)return e.position||(e.position=5),e.scale||(e.scale=1),e.alpha||(e.alpha=0.2),a=new Image,a.onload=function(a){var b,
f,d;a=a.currentTarget;c.context.globalAlpha=e.alpha;d=null!=(b=e.width)?b:a.width*e.scale;b=null!=(f=e.height)?f:a.height*e.scale;f=c.determinePosition(e.position,d,b);c.context.drawImage(a,f.x,f.y,d,b);c.context.globalAlpha=1;return c.setupPad()},a.src=e.url};a.prototype.determinePosition=function(e,b,c){var g,d;g=(this.width-b)/2;d=(this.height-c)/2;b=this.width-b;c=this.height-c;switch(e){case a.NORTH_WEST:return{x:0,y:0};case a.NORTH:return{x:g,y:0};case a.NORTH_EAST:return{x:b,y:0};case a.WEST:return{x:0,
y:d};case a.CENTER:return{x:g,y:d};case a.EAST:return{x:b,y:d};case a.SOUTH_WEST:return{x:0,y:c};case a.SOUTH:return{x:g,y:c};case a.SOUTH_EAST:return{x:b,y:c}}};a.prototype.initializeCanvas=function(){this.canvas=document.createElement("canvas");this.canvas.id="signature-canvas";this.canvas.width=this.width;this.canvas.height=this.height;this.display.appendChild(this.canvas);return this.context=this.canvas.getContext("2d")};a.prototype.drawLine=function(a){var b,c,d,h,f;if(1<a.points.length){this.context.beginPath();
this.context.moveTo(a.points[0].x,a.points[0].y);h=a.points.slice(1);c=0;for(d=h.length;c<d;c++)b=h[c],this.context.lineTo(b.x,b.y);this.context.lineWidth=null!=(f=a.lineWidth)?f:1;return this.context.stroke()}};a.prototype.setupPad=function(){this.drawLine({points:[{x:20,y:this.height-15},{x:this.width-20,y:this.height-15}]});this.drawLine({points:[{x:25,y:this.height-32},{x:35,y:this.height-22}],lineWidth:2});return this.drawLine({points:[{x:35,y:this.height-32},{x:25,y:this.height-22}],lineWidth:2})};
a.prototype.asBase64PNG=function(){return this.canvas.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")};a.prototype.setupListeners=function(){this.display.onmousedown=this.onMouseDown;this.display.onmouseup=this.onMouseUp;this.display.onmouseout=this.onMouseOut;this.display.onmouseover=this.onMouseOver;this.display.onmousemove=this.onMouseMove;this.display.addEventListener("touchstart",this.touchHandler,!0);this.display.addEventListener("touchmove",this.touchHandler,!0);this.display.addEventListener("touchend",
this.touchHandler,!0);return this.display.addEventListener("touchcancel",this.touchHandler,!0)};a.prototype.touchHandler=function(a){var b,c,d;b=event.changedTouches[0];d="";switch(a.type){case "touchstart":d="mousedown";break;case "touchstart":d="mousedown";break;case "touchmove":d="mousemove";break;case "touchend":d="mouseup"}c=document.createEvent("MouseEvent");c.initMouseEvent(d,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(c);return a.preventDefault()};
a.prototype.onMouseMove=function(a){var b,c;if(this.drawing)return this.newPoint={x:null!=(b=a.offsetX)?b:a.layerX-this.display.offsetLeft,y:null!=(c=a.offsetY)?c:a.layerY-this.display.offsetTop},this.drawLine({points:[this.prevPoint,this.newPoint],lineWidth:2}),this.prevPoint=this.newPoint,console.log("drawing")};a.prototype.onMouseDown=function(a){var b,c;this.drawing=!0;this.prevPoint={x:null!=(b=a.offsetX)?b:a.layerX-this.display.offsetLeft,y:null!=(c=a.offsetY)?c:a.layerY-this.display.offsetTop};
return console.log(a)};a.prototype.onMouseUp=function(){return this.drawing=!1};a.prototype.onMouseOut=function(){return this.drawing=!1};a.prototype.onMouseOver=function(){};return a}();("undefined"!==typeof exports&&null!==exports?exports:window).Signature=k}).call(this);
