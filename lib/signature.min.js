(function(){var l,h=function(a,d){return function(){return a.apply(d,arguments)}};l=function(){function a(d){this.onMouseOut=h(this.onMouseOut,this);this.onMouseUp=h(this.onMouseUp,this);this.onMouseDown=h(this.onMouseDown,this);this.onMouseMove=h(this.onMouseMove,this);this.determinePosition=h(this.determinePosition,this);null==d.displayId&&alert("Signature\u00a0requires a displayId in the options hash passed to it's constructor");this.options=d;this.display=document.getElementById(d.displayId);
this.width=this.display.clientWidth;this.height=this.display.clientHeight;this.initializeCanvas();null!=this.options.explanation&&this.initializeExplanation();null!=d.watermark?this.setWatermark(d.watermark):this.setupPad();this.setupListeners()}a.NORTH_WEST=0;a.NORTH=1;a.NORTH_EAST=2;a.WEST=3;a.CENTER=4;a.EAST=5;a.SOUTH_WEST=6;a.SOUTH=7;a.SOUTH_EAST=8;a.prototype.setWatermark=function(d){var c,b=this;if(d.url)return d.position||(d.position=5),d.scale||(d.scale=1),d.alpha||(d.alpha=0.2),c=new Image,
c.onload=function(c){var a,g,k;c=c.currentTarget;b.context.globalAlpha=d.alpha;k=null!=(a=d.width)?a:c.width*d.scale;a=null!=(g=d.height)?g:c.height*d.scale;g=b.determinePosition(d.position,k,a);b.context.drawImage(c,g.x,g.y,k,a);b.context.globalAlpha=1;return b.setupPad()},c.src=d.url};a.prototype.determinePosition=function(d,c,b){var f,e;f=(this.width-c)/2;e=(this.height-b)/2;c=this.width-c;b=this.height-b;switch(d){case a.NORTH_WEST:return{x:0,y:0};case a.NORTH:return{x:f,y:0};case a.NORTH_EAST:return{x:c,
y:0};case a.WEST:return{x:0,y:e};case a.CENTER:return{x:f,y:e};case a.EAST:return{x:c,y:e};case a.SOUTH_WEST:return{x:0,y:b};case a.SOUTH:return{x:f,y:b};case a.SOUTH_EAST:return{x:c,y:b}}};a.prototype.initializeExplanation=function(){var d,c,b,f,e,g;this.explanation=this.options.explanation;(d=this.explanation).size||(d.size=10);(c=this.explanation).weight||(c.weight="normal");(b=this.explanation).font||(b.font="sans-serif");(f=this.explanation).maxWidth||(f.maxWidth=this.display.offsetWidth);(e=
this.explanation).lineHeight||(e.lineHeight=1.2*this.explanation.size);(g=this.explanation).color||(g.color="#000");if(null==this.explanation.position)return this.explanation.position=a.NORTH};a.prototype.initializeCanvas=function(){this.canvas=document.createElement("canvas");this.canvas.id="signature-canvas";this.canvas.width=this.width;this.canvas.height=this.height;this.display.appendChild(this.canvas);return this.context=this.canvas.getContext("2d")};a.prototype.drawLine=function(d){var c,b,
a,e,g;if(1<d.points.length){this.context.beginPath();this.context.moveTo(d.points[0].x,d.points[0].y);e=d.points.slice(1);b=0;for(a=e.length;b<a;b++)c=e[b],this.context.lineTo(c.x,c.y);this.context.lineWidth=null!=(g=d.lineWidth)?g:1;return this.context.stroke()}};a.prototype.setupPad=function(){null!=this.options.explanation&&this.drawExplanation();this.drawLine({points:[{x:20,y:this.height-15},{x:this.width-20,y:this.height-15}]});this.drawLine({points:[{x:25,y:this.height-32},{x:35,y:this.height-
22}],lineWidth:2});return this.drawLine({points:[{x:35,y:this.height-32},{x:25,y:this.height-22}],lineWidth:2})};a.prototype.drawExplanation=function(){var d,c,b,a,e;this.captureContextTextStyle();this.context.font=""+this.explanation.weight+" "+this.explanation.size+"px "+this.explanation.font;this.context.textBaseline="top";this.context.fillStyle=this.explanation.color;b={};switch(this.explanation.position%3){case 0:this.context.textAlign="left";b.x=0;break;case 1:this.context.textAlign="center";
b.x=this.width/2;break;case 2:this.context.textAlign="right",b.x=this.width}c=this.wrapTextIfNecessary(this.explanation.text,b.x,b.y,this.explanation.maxWidth,this.explanation.lineHeight);switch(Math.floor(this.explanation.position/3)){case 0:b.y=0;break;case 1:b.y=this.height/2-c.length*this.explanation.lineHeight/2;break;case 2:b.y=this.height-c.length*this.explanation.lineHeight}a=0;for(e=c.length;a<e;a++)d=c[a],this.context.fillText(d,b.x,b.y),b.y+=this.explanation.lineHeight;return this.restoreContextTextStyle()};
a.prototype.captureContextTextStyle=function(){this.contextFillStyle=this.context.fillStyle;this.contextFontStyle=this.context.font;return this.contextTextBaseline=this.context.textBaseline};a.prototype.restoreContextTextStyle=function(){this.context.fillStyle=this.contextFillStyle;this.context.font=this.contextFontStyle;return this.context.textBaseline=this.contextTextBaseline};a.prototype.wrapTextIfNecessary=function(d,a,b,f,e){var g,k,h;a="";b=[];h=d.split(" ");g=0;for(k=h.length;g<k;g++)e=h[g],
d=""+a+e+" ",this.context.measureText(d).width>f?(b.push(a),a=""+e+" "):a=d;b.push(a);return b};a.prototype.asBase64PNG=function(){return this.canvas.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")};a.prototype.setupListeners=function(){this.display.onmousedown=this.onMouseDown;this.display.onmouseup=this.onMouseUp;this.display.onmouseout=this.onMouseOut;this.display.onmousemove=this.onMouseMove;this.display.addEventListener("touchstart",this.touchHandler,!0);this.display.addEventListener("touchmove",
this.touchHandler,!0);this.display.addEventListener("touchend",this.touchHandler,!0);return this.display.addEventListener("touchcancel",this.touchHandler,!0)};a.prototype.touchHandler=function(a){var c,b,f;c=event.changedTouches[0];f="";switch(a.type){case "touchstart":f="mousedown";break;case "touchstart":f="mousedown";break;case "touchmove":f="mousemove";break;case "touchend":f="mouseup"}b=document.createEvent("MouseEvent");b.initMouseEvent(f,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,
!1,!1,!1,!1,0,null);c.target.dispatchEvent(b);return a.preventDefault()};a.prototype.onMouseMove=function(a){var c,b;if(this.drawing)return this.newPoint={x:null!=(c=a.offsetX)?c:a.layerX-this.display.offsetLeft,y:null!=(b=a.offsetY)?b:a.layerY-this.display.offsetTop},this.drawLine({points:[this.prevPoint,this.newPoint],lineWidth:2}),this.prevPoint=this.newPoint,console.log("drawing")};a.prototype.onMouseDown=function(a){var c,b;this.drawing=!0;this.prevPoint={x:null!=(c=a.offsetX)?c:a.layerX-this.display.offsetLeft,
y:null!=(b=a.offsetY)?b:a.layerY-this.display.offsetTop};return console.log(a)};a.prototype.onMouseUp=function(){return this.drawing=!1};a.prototype.onMouseOut=function(){return this.drawing=!1};return a}();window.Signature=l}).call(this);
