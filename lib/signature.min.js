(function(){var l,h=function(a,c){return function(){return a.apply(c,arguments)}};l=function(){function a(c){this.onMouseOver=h(this.onMouseOver,this);this.onMouseOut=h(this.onMouseOut,this);this.onMouseUp=h(this.onMouseUp,this);this.onMouseDown=h(this.onMouseDown,this);this.onMouseMove=h(this.onMouseMove,this);this.determinePosition=h(this.determinePosition,this);null==c.displayId&&alert("Signature\u00a0requires a displayId in the options hash passed to it's constructor");this.options=c;this.display=
document.getElementById(c.displayId);this.width=this.display.clientWidth;this.height=this.display.clientHeight;this.initializeCanvas();null!=this.options.explanation&&this.initializeExplanation();null!=c.watermark?this.setWatermark(c.watermark):this.setupPad();this.setupListeners()}a.NORTH_WEST=0;a.NORTH=1;a.NORTH_EAST=2;a.WEST=3;a.CENTER=4;a.EAST=5;a.SOUTH_WEST=6;a.SOUTH=7;a.SOUTH_EAST=8;a.prototype.setWatermark=function(c){var d,b=this;if(c.url)return c.position||(c.position=5),c.scale||(c.scale=
1),c.alpha||(c.alpha=0.2),d=new Image,d.onload=function(d){var a,g,k;d=d.currentTarget;b.context.globalAlpha=c.alpha;k=null!=(a=c.width)?a:d.width*c.scale;a=null!=(g=c.height)?g:d.height*c.scale;g=b.determinePosition(c.position,k,a);b.context.drawImage(d,g.x,g.y,k,a);b.context.globalAlpha=1;return b.setupPad()},d.src=c.url};a.prototype.determinePosition=function(c,d,b){var e,f;e=(this.width-d)/2;f=(this.height-b)/2;d=this.width-d;b=this.height-b;switch(c){case a.NORTH_WEST:return{x:0,y:0};case a.NORTH:return{x:e,
y:0};case a.NORTH_EAST:return{x:d,y:0};case a.WEST:return{x:0,y:f};case a.CENTER:return{x:e,y:f};case a.EAST:return{x:d,y:f};case a.SOUTH_WEST:return{x:0,y:b};case a.SOUTH:return{x:e,y:b};case a.SOUTH_EAST:return{x:d,y:b}}};a.prototype.initializeExplanation=function(){var c,d,b,e,f,g;this.explanation=this.options.explanation;(c=this.explanation).size||(c.size=10);(d=this.explanation).weight||(d.weight="normal");(b=this.explanation).font||(b.font="sans-serif");(e=this.explanation).maxWidth||(e.maxWidth=
this.display.offsetWidth);(f=this.explanation).lineHeight||(f.lineHeight=1.2*this.explanation.size);(g=this.explanation).color||(g.color="#000");if(null==this.explanation.position)return this.explanation.position=a.NORTH};a.prototype.initializeCanvas=function(){this.canvas=document.createElement("canvas");this.canvas.id="signature-canvas";this.canvas.width=this.width;this.canvas.height=this.height;this.display.appendChild(this.canvas);return this.context=this.canvas.getContext("2d")};a.prototype.drawLine=
function(c){var d,b,a,f,g;if(1<c.points.length){this.context.beginPath();this.context.moveTo(c.points[0].x,c.points[0].y);f=c.points.slice(1);b=0;for(a=f.length;b<a;b++)d=f[b],this.context.lineTo(d.x,d.y);this.context.lineWidth=null!=(g=c.lineWidth)?g:1;return this.context.stroke()}};a.prototype.setupPad=function(){null!=this.options.explanation&&this.drawExplanation();this.drawLine({points:[{x:20,y:this.height-15},{x:this.width-20,y:this.height-15}]});this.drawLine({points:[{x:25,y:this.height-32},
{x:35,y:this.height-22}],lineWidth:2});return this.drawLine({points:[{x:35,y:this.height-32},{x:25,y:this.height-22}],lineWidth:2})};a.prototype.drawExplanation=function(){var c,a,b,e,f;this.captureContextTextStyle();this.context.font=""+this.explanation.weight+" "+this.explanation.size+"px "+this.explanation.font;this.context.textBaseline="top";this.context.fillStyle=this.explanation.color;b={};switch(this.explanation.position%3){case 0:this.context.textAlign="left";b.x=0;break;case 1:this.context.textAlign=
"center";b.x=this.width/2;break;case 2:this.context.textAlign="right",b.x=this.width}a=this.wrapTextIfNecessary(this.explanation.text,b.x,b.y,this.explanation.maxWidth,this.explanation.lineHeight);switch(Math.floor(this.explanation.position/3)){case 0:b.y=0;break;case 1:b.y=this.height/2-a.length*this.explanation.lineHeight/2;break;case 2:b.y=this.height-a.length*this.explanation.lineHeight}e=0;for(f=a.length;e<f;e++)c=a[e],this.context.fillText(c,b.x,b.y),b.y+=this.explanation.lineHeight;return this.restoreContextTextStyle()};
a.prototype.captureContextTextStyle=function(){this.contextFillStyle=this.context.fillStyle;this.contextFontStyle=this.context.font;return this.contextTextBaseline=this.context.textBaseline};a.prototype.restoreContextTextStyle=function(){this.context.fillStyle=this.contextFillStyle;this.context.font=this.contextFontStyle;return this.context.textBaseline=this.contextTextBaseline};a.prototype.wrapTextIfNecessary=function(c,a,b,e,f){var g,k,h;g=c.split(" ");c="";a=[];k=0;for(h=g.length;k<h;k++)f=g[k],
b=""+c+f+" ",this.context.measureText(b).width>e?(a.push(c),c=""+f+" "):c=b;a.push(c);return a};a.prototype.asBase64PNG=function(){return this.canvas.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")};a.prototype.setupListeners=function(){this.display.onmousedown=this.onMouseDown;this.display.onmouseup=this.onMouseUp;this.display.onmouseout=this.onMouseOut;this.display.onmouseover=this.onMouseOver;this.display.onmousemove=this.onMouseMove;this.display.addEventListener("touchstart",this.touchHandler,
!0);this.display.addEventListener("touchmove",this.touchHandler,!0);this.display.addEventListener("touchend",this.touchHandler,!0);return this.display.addEventListener("touchcancel",this.touchHandler,!0)};a.prototype.touchHandler=function(a){var d,b,e;d=event.changedTouches[0];e="";switch(a.type){case "touchstart":e="mousedown";break;case "touchstart":e="mousedown";break;case "touchmove":e="mousemove";break;case "touchend":e="mouseup"}b=document.createEvent("MouseEvent");b.initMouseEvent(e,!0,!0,
window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null);d.target.dispatchEvent(b);return a.preventDefault()};a.prototype.onMouseMove=function(a){var d,b;if(this.drawing)return this.newPoint={x:null!=(d=a.offsetX)?d:a.layerX-this.display.offsetLeft,y:null!=(b=a.offsetY)?b:a.layerY-this.display.offsetTop},this.drawLine({points:[this.prevPoint,this.newPoint],lineWidth:2}),this.prevPoint=this.newPoint,console.log("drawing")};a.prototype.onMouseDown=function(a){var d,b;this.drawing=!0;this.prevPoint=
{x:null!=(d=a.offsetX)?d:a.layerX-this.display.offsetLeft,y:null!=(b=a.offsetY)?b:a.layerY-this.display.offsetTop};return console.log(a)};a.prototype.onMouseUp=function(){return this.drawing=!1};a.prototype.onMouseOut=function(){return this.drawing=!1};a.prototype.onMouseOver=function(){};return a}();("undefined"!==typeof exports&&null!==exports?exports:window).Signature=l}).call(this);
